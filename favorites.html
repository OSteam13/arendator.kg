<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Избранное — Arendator.kg</title>
  <link rel="icon" href="./images/Arendatorkg.png">
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--container:1180px}
    .container{max-width:var(--container)}
    .shadow-soft{box-shadow:0 8px 30px rgba(0,0,0,.08)}
    html,body{overflow-x:hidden;font-family:'Onest',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
    .lang-toggle{padding:.25rem .5rem;border:1px solid rgb(229 231 235);border-radius:.75rem}
    .lang-toggle span{opacity:.55}
    .lang-toggle .active{opacity:1;font-weight:700}
    .tg-ico{display:inline-flex;align-items:center;margin-right:.5rem}
    .tg-ico svg{width:18px;height:18px}
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">

  <!-- верхняя полоса -->
  <div class="bg-emerald-600 text-white text-center text-xs sm:text-sm py-2">
    Объявления живут 24 часа · Анти-агент фильтр включён · Контакты — в Telegram
  </div>

  <!-- Шапка как на главной -->
  <header class="bg-white sticky top-0 z-30 border-b border-neutral-100/80">
    <div class="container mx-auto px-4 py-2 md:py-3">
      <div class="flex flex-wrap items-center gap-3">
        <!-- Лого -->
        <a href="index.html" class="order-1 flex items-center gap-2 shrink-0">
          <img src="./images/Arendatorkg.png" alt="Arendator.kg" class="w-8 h-8 rounded-full object-contain">
          <span class="font-semibold hidden sm:inline">Arendator.kg</span>
        </a>

        <!-- Навигация: мобайл — 3 колонки, ПК — в одну строку -->
        <nav class="order-3 w-full mt-2 grid grid-cols-3 gap-2 text-sm
                    md:order-2 md:w-auto md:mt-0 md:grid-cols-none md:flex md:flex-1 md:justify-center md:gap-3">
          <a href="blog.html" class="w-full px-3 py-1.5 text-center rounded-xl border border-neutral-200 hover:bg-neutral-50">Блог</a>
          <a href="post.html" class="w-full px-3 py-1.5 text-center rounded-xl bg-neutral-900 text-white hover:bg-neutral-800">Добавить объявление</a>
          <a href="favorites.html?v=3" class="w-full px-3 py-1.5 text-center rounded-xl border border-neutral-200 hover:bg-neutral-50">Избранное</a>
        </nav>

        <!-- Язык -->
        <button id="langToggle" class="order-2 md:order-3 ml-auto lang-toggle text-sm" type="button">
          <span class="ru active">Рус</span> / <span class="ky">Кыр</span>
        </button>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-6 md:py-8">
    <h1 class="text-2xl md:text-3xl font-bold mb-4">Избранное</h1>

    <!-- Пустое состояние -->
    <div id="empty" class="hidden rounded-2xl border border-neutral-200 bg-white shadow-soft p-10 text-center text-neutral-600">
      Пока пусто: ничего не выбрано.
      <div class="mt-3">
        <a href="index.html#feed" class="text-blue-600 hover:underline">Вернуться и выбрать объявления</a>
      </div>
    </div>

    <!-- Сетка избранных -->
    <div id="grid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-4"></div>
  </main>

  <!-- Контакты -->
  <section id="contact" class="container mx-auto px-4 pb-10">
    <h2 class="text-2xl font-bold mb-3">Связаться с нами</h2>
    <p class="text-neutral-700 mb-4 text-sm">Задайте вопрос — ответим на почту в течение дня.</p>

    <form id="contactForm" class="bg-white border border-neutral-200 rounded-2xl shadow-soft p-5 grid gap-3 max-w-2xl">
      <div class="grid sm:grid-cols-2 gap-3">
        <input type="text" name="name" placeholder="Ваше имя" required class="px-3 py-2 rounded-xl border border-neutral-200">
        <input type="email" name="email" placeholder="Ваш email" required class="px-3 py-2 rounded-xl border border-neutral-200">
      </div>
      <input type="text" name="website" style="display:none">
      <input type="hidden" name="ts" id="tsField">
      <textarea name="message" rows="5" placeholder="Сообщение" required class="px-3 py-2 rounded-xl border border-neutral-200"></textarea>
      <button type="submit" class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700">Отправить</button>
      <div id="contactNote" class="text-xs text-neutral-500"></div>
    </form>
  </section>

  <!-- Футер -->
  <footer class="border-t border-neutral-100 bg-white">
    <div class="container mx-auto px-4 py-8 grid md:grid-cols-4 gap-6 text-sm">
      <div class="md:col-span-2">
        <div class="flex items-center gap-2">
          <img src="./images/Arendatorkg.png" alt="Arendator.kg" class="w-7 h-7 rounded-full object-contain">
          <span class="font-semibold">Arendator.kg</span>
        </div>
        <p class="text-neutral-600 mt-2 max-w-[60ch]">Автоматически мониторим свежие объявления от владельцев и проверенных источников — быстрее и без посредников.</p>
      </div>
      <div>
        <div class="font-semibold">Навигация</div>
        <ul class="mt-2 space-y-1 text-neutral-600">
          <li><a href="post.html" class="hover:text-blue-600">Добавить объявление</a></li>
          <li><a href="blog.html" class="hover:text-blue-600">Блог</a></li>
          <li><a href="favorites.html?v=3" class="hover:text-blue-600">Избранное</a></li>
        </ul>
      </div>
      <div>
        <div class="font-semibold">Правовое</div>
        <ul class="mt-2 space-y-1 text-neutral-600">
          <li><a class="hover:text-blue-600" href="data-deletion.html">Удаление данных</a></li>
          <li><a class="hover:text-blue-600" href="#">Политика конфиденциальности</a></li>
        </ul>
      </div>
    </div>
    <div class="text-center text-xs text-neutral-500 pb-6">© 2025 — Arendator.kg</div>
  </footer>

  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden px-4 py-2 rounded-xl bg-neutral-900 text-white text-sm"></div>

  <script>
    const TELEGRAM_URL = 'https://t.me/arendatorkg';

    /* Демо-список для сборки карточек по id */
    const listings = [
      { id:'l1', title:'2к, Центр, свежий ремонт', price:35000, district:'Центр', rooms:'2', daily:false, img:'' },
      { id:'l2', title:'1к, Майевка, уютная',      price:18000, district:'Майевка', rooms:'1', daily:false, img:'https://images.unsplash.com/photo-1502005229762-cf1b2da7cda7?w=1200&auto=format&fit=crop' },
      { id:'l3', title:'3к, Асанбай, вид на горы', price:55000, district:'Асанбай', rooms:'3', daily:false, img:'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=1200&auto=format&fit=crop' },
      { id:'l4', title:'Студия, Московский',       price:22000, district:'Московский', rooms:'1', daily:false, img:'https://images.unsplash.com/photo-1493809842364-78817add7ffb?w=1200&auto=format&fit=crop' },
      { id:'l5', title:'Посуточно 2к, Центр',      price:3000,  district:'Центр', rooms:'2', daily:true,  img:'https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?w=1200&auto=format&fit=crop' },
      { id:'l6', title:'3к, Свердловский, новая мебель', price:45000, district:'Свердловский', rooms:'3', daily:false, img:'https://images.unsplash.com/photo-1494526585095-c41746248156?w=1200&auto=format&fit=crop' },
    ];

    const qs = (s,el=document)=>el.querySelector(s);
    const showToast=(m)=>{const t=qs('#toast'); t.textContent=m; t.classList.remove('hidden'); clearTimeout(showToast.t); showToast.t=setTimeout(()=>t.classList.add('hidden'),2000);};
    const priceUnit = (daily)=> daily ? 'сом/сут' : 'сом/мес';

    /* Карточка: без бейджей, одинаковые зоны текста/кнопок */
    function cardHTML(it){
      const price = `${Number(it.price).toLocaleString('ru-RU')} <span class="text-sm font-medium text-neutral-500">${priceUnit(it.daily)}</span>`;
      return `
      <article class="rounded-2xl border border-neutral-200 bg-white overflow-hidden shadow-sm hover:shadow-md transition-shadow flex flex-col h-full">
        <div class="aspect-[4/3] overflow-hidden grid place-items-center bg-neutral-100">
          ${it.img ? `<img src="${it.img}" alt="${it.title}" class="w-full h-full object-cover" loading="lazy">`
                    : `<div class="text-neutral-500 text-sm">Нет фото</div>`}
        </div>
        <div class="p-3 sm:p-4 flex-1 flex flex-col gap-3">
          <h3 class="font-semibold leading-snug text-sm sm:text-base">${it.title}</h3>
          <div class="text-lg sm:text-2xl font-bold">${price}</div>
          <div class="text-[12px] sm:text-sm text-neutral-600">${it.district || ''}</div>
          <div class="mt-auto grid grid-cols-1 gap-2">
            <a class="px-3 py-2 rounded-xl bg-blue-600 text-white text-sm text-center hover:bg-blue-700 inline-flex items-center justify-center"
               href="${TELEGRAM_URL}" target="_blank" rel="noopener">
              <span class="tg-ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.999 15.2 9.9 19c.4 0 .6-.2.8-.4l1.9-1.8 4.1 3c.8.4 1.4.2 1.6-.8l2.9-13.5c.3-1.3-.5-1.8-1.3-1.5L2.5 9.4c-1.3.5-1.3 1.2-.2 1.5l4.6 1.4L18.9 6c.7-.4 1.3-.2 .8.2"/></svg>
              </span>
              Получить номер в Telegram
            </a>
            <button class="unfav-btn text-xs text-neutral-600 justify-self-end hover:text-red-600 inline-flex items-center gap-1" data-id="${it.id}">
              <span class="text-red-600">❤</span> Удалить
            </button>
          </div>
        </div>
      </article>`;
    }

    function render(){
      const favIds = JSON.parse(localStorage.getItem('favs')||'[]');
      const grid = qs('#grid');
      const empty = qs('#empty');

      if (!favIds.length){
        empty.classList.remove('hidden');
        grid.innerHTML = '';
        return;
      }
      empty.classList.add('hidden');

      const items = favIds.map(id => listings.find(x=>x.id===id)).filter(Boolean);
      grid.innerHTML = items.map(cardHTML).join('');

      grid.querySelectorAll('.unfav-btn').forEach(b=>{
        b.addEventListener('click', ()=>{
          const id = b.dataset.id;
          const favs = new Set(JSON.parse(localStorage.getItem('favs')||'[]'));
          favs.delete(id);
          localStorage.setItem('favs', JSON.stringify([...favs]));
          showToast('Убрано из избранного');
          render();
        });
      });
    }

    /* Мини-переключатель языка (только шапка) */
    (function(){
      const btn = document.getElementById('langToggle');
      const set = (lang) => {
        btn.querySelector('.ru').classList.toggle('active', lang==='ru');
        btn.querySelector('.ky').classList.toggle('active', lang==='ky');
        const nav = document.querySelector('header nav'); if (!nav) return;
        const labels = { ru: ['Блог','Добавить объявление','Избранное'], ky:['Блог','Жарна кошуу','Тандалгандар'] };
        const [blog,add,fav] = labels[lang];
        nav.children[0].textContent = blog;
        nav.children[1].textContent = add;
        nav.children[2].textContent = fav;
      };
      let cur = localStorage.getItem('lang') || 'ru';
      set(cur);
      btn.addEventListener('click', ()=>{ cur = (cur==='ru'?'ky':'ru'); localStorage.setItem('lang',cur); set(cur); });
    })();

    /* Удалим старый секшен «Тарифы доступа», если он вдруг попал из кэша */
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('section').forEach(sec=>{
        const h2 = sec.querySelector('h2');
        if (h2 && /тарифы доступа/i.test(h2.textContent)) sec.remove();
      });
      render();
    });

    /* Контактная форма */
    (function initContact(){
      const ts = document.getElementById('tsField'); if (ts) ts.value = Date.now();
      const form = document.getElementById('contactForm');
      const note = document.getElementById('contactNote');
      if (!form) return;
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const fd = new FormData(form);
        const payload = Object.fromEntries(fd.entries());
        if (payload.website && payload.website.trim() !== '') { form.reset(); if (note) note.textContent='Спасибо!'; return; }
        payload.to = 'reply@arendator.kg';
        try{
          const res = await fetch('/api/send-mail', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
          const data = await res.json();
          if (data.ok){ form.reset(); if (note) note.textContent='Сообщение отправлено.'; if (ts) ts.value=Date.now(); }
          else { if (note) note.textContent='Ошибка: ' + (data.error||'не удалось отправить'); }
        }catch{ if (note) note.textContent='Ошибка сети. Попробуйте ещё раз.'; }
      });
    })();
  </script>
</body>
</html>
