<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arendator.kg — свежие квартиры без посредников</title>
  <meta name="description" content="Свежие объявления аренды от владельцев. Анти-агент фильтр, контакты — в Telegram." />
  <link rel="icon" href="./images/Arendatorkg.png">
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--container:1180px}
    .container{max-width:var(--container)}
    .shadow-soft{box-shadow:0 8px 30px rgba(0,0,0,.08)}
    html,body{overflow-x:hidden;font-family:'Onest',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;font-weight:400}
    .hero-title{font-weight:800}
    .lang-toggle{padding:.25rem .5rem;border:1px solid rgb(229 231 235);border-radius:.75rem}
    .lang-toggle span{opacity:.55}
    .lang-toggle .active{opacity:1;font-weight:700}
    .tg-ico{display:inline-flex;align-items:center;margin-right:.5rem}
    .tg-ico svg{width:18px;height:18px}
    /* === карточки объявлений (минимальные стили) === */
    .ads-wrap { margin: 24px auto; max-width: var(--container); padding: 0 16px; }
    .ads-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; }
    .ad-card { border: 1px solid #eee; border-radius: 14px; overflow: hidden; background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,.03); display: flex; flex-direction: column; }
    .ad-thumb { aspect-ratio: 4 / 3; background: #f6f7f8; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .ad-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .ad-body { padding: 12px 14px; display: flex; flex-direction: column; gap: 8px; }
    .ad-title { font: 600 16px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; }
    .ad-price { color: #0d6efd; font-weight: 700; }
    .ad-meta { color: #666; font-size: 13px; }
    .ad-cta { margin-top: 6px; display: inline-block; text-decoration: none; background: #0d6efd; color: #fff; padding: 8px 10px; border-radius: 10px; }
    .ads-empty { text-align: center; color: #666; padding: 24px 0; }
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">

  <!-- Верхняя полоса -->
  <div class="bg-emerald-600 text-white text-center text-xs sm:text-sm py-2">
    Объявления живут 24 часа · Анти-агент фильтр включён · Контакты — в Telegram
  </div>

  <!-- Хедер -->
  <header class="bg-white sticky top-0 z-30 border-b border-neutral-100/80">
    <div class="container mx-auto px-4 py-2 md:py-2">
      <div class="flex flex-wrap items-center gap-3">
        <!-- Логотип -->
        <a href="/" class="order-1 flex items-center gap-2 shrink-0">
          <img src="./images/Arendatorkg.png" alt="Arendator.kg" class="w-8 h-8 rounded-full object-contain">
        </a>

        <!-- Навигация -->
        <nav class="order-3 w-full mt-1 grid grid-cols-3 gap-2 text-sm
                    md:order-2 md:w-auto md:mt-0 md:grid-cols-none md:flex md:flex-1 md:justify-center md:gap-3">
          <a href="blog.html"
             class="w-full h-9 px-3 rounded-xl border border-neutral-200 hover:bg-neutral-50 flex items-center justify-center text-center">
            Блог
          </a>
          <a href="post.html"
             class="w-full h-9 px-3 rounded-xl bg-neutral-900 text-white hover:bg-neutral-800 flex items-center justify-center text-center">
            Добавить объявление
          </a>
          <a href="favorites.html"
             class="w-full h-9 px-3 rounded-xl border border-neutral-200 hover:bg-neutral-50 flex items-center justify-center text-center">
            Избранное
          </a>
        </nav>

        <!-- Переключатель языка (без логики, просто заглушка) -->
        <button class="order-2 md:order-3 ml-auto lang-toggle text-sm" type="button" disabled>
          <span class="active">Рус</span> / <span>Кыр</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Герой -->
  <section class="container mx-auto px-4 pt-6 pb-4">
    <div class="rounded-2xl bg-white border border-neutral-200 shadow-soft p-4 md:p-6 grid md:grid-cols-2 gap-4 items-center">
      <div>
        <h1 class="hero-title text-3xl md:text-5xl leading-tight text-blue-600">Ищете квартиру в аренду?</h1>
        <p class="mt-2 text-base md:text-lg text-neutral-600">
          Экономьте время и нервы: мы находим «живые» объявления, отсекаем посредников, выдаём контакты в Telegram — без спама и лишних звонков.
        </p>
        <div class="mt-4 flex flex-col sm:flex-row flex-wrap gap-1">
          <a class="w-full sm:w-auto sm:min-w-[260px] px-5 py-3 rounded-xl bg-blue-600 text-white hover:bg-blue-700 inline-flex items-center justify-center"
             href="https://t.me/ArendatorKg_VIP_bot" target="_blank" rel="noopener">
            <span class="tg-ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.999 15.2 9.9 19c.4 0 .6-.2.8-.4l1.9-1.8 4.1 3c.8.4 1.4.2 1.6-.8l2.9-13.5c.3-1.3-.5-1.8-1.3-1.5L2.5 9.4c-1.3.5-1.3 1.2-.2 1.5l4.6 1.4L18.9 6c.7-.4 1.3-.2.8.2"/></svg>
            </span>
            Открыть в Telegram
          </a>
          <a class="w-full sm:w-auto sm:min-w-[260px] px-5 py-3 rounded-xl border border-neutral-200 hover:bg-neutral-50 text-center"
             href="#feed">Смотреть ленту на сайте</a>
        </div>
        <div class="mt-3 flex items-center gap-2 text-sm text-neutral-600">
          <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500"></span> Анти-агент фильтр</div>
          <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-blue-600"></span> Ежесекундные обновления</div>
        </div>
      </div>
      <div class="rounded-xl overflow-hidden border border-neutral-200">
        <div class="aspect-[16/9] bg-neutral-100"></div>
      </div>
    </div>
  </section>

  <!-- Рекламный слот -->
  <div class="container mx-auto px-4">
    <div class="my-3 rounded-2xl border border-neutral-200 bg-white shadow-soft grid place-items-center min-h-[72px] sm:min-h-[90px]">
      <span class="text-sm text-neutral-500">Место для рекламы (банк · мебель · интернет)</span>
    </div>
  </div>

  <!-- Лента -->
  <main id="feed" class="container mx-auto px-4 pb-6">
    <section class="ads-wrap">
      <h2 class="text-2xl font-bold mb-2">Свежие объявления</h2>
      <div id="ads" class="ads-grid"></div>
      <div id="ads-empty" class="ads-empty" hidden>Объявлений пока нет</div>
    </section>
  </main>

  <!-- Тарифы -->
  <section class="container mx-auto px-4 pb-8">
    <h2 class="text-2xl font-bold mb-1">Доступ к контактам</h2>
    <p class="text-neutral-700 mb-4">Лучшие варианты улетают за часы. Подключите доступ — бот пришлёт контакты владельцев.</p>

    <div class="grid sm:grid-cols-2 gap-3">
      <div class="rounded-2xl border border-neutral-200 bg-white p-4 shadow-soft">
        <div class="text-xl font-bold mb-1">300 сом — Неделя</div>
        <ul class="space-y-1 text-neutral-700 text-sm mb-3">
          <li>• Контакты владельцев без лимита</li>
          <li>• Анти-агент фильтр</li>
          <li>• Уведомления о новых совпадениях</li>
        </ul>
        <a class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 inline-flex items-center"
           href="https://t.me/ArendatorKg_VIP_bot" target="_blank" rel="noopener">
          <span class="tg-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.999 15.2 9.9 19c.4 0 .6-.2.8-.4l1.9-1.8 4.1 3c.8.4 1.4.2 1.6-.8l2.9-13.5c.3-1.3-.5-1.8-1.3-1.5L2.5 9.4c-1.3.5-1.3 1.2-.2 1.5l4.6 1.4L18.9 6c.7-.4 1.3-.2.8.2"/></svg>
          </span>
          Получить в Telegram
        </a>
      </div>

      <div class="rounded-2xl border border-neutral-200 bg-white p-4 shadow-soft">
        <div class="text-xl font-bold mb-1">600 сом — Месяц</div>
        <ul class="space-y-1 text-neutral-700 text-sm mb-3">
          <li>• Контакты владельцев без лимита</li>
          <li>• Анти-агент фильтр</li>
          <li>• Уведомления о новых совпадениях</li>
        </ul>
        <a class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 inline-flex items-center"
           href="https://t.me/ArendatorKg_VIP_bot" target="_blank" rel="noopener">
          <span class="tg-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.999 15.2 9.9 19c.4 0 .6-.2.8-.4l1.9-1.8 4.1 3c.8.4 1.4.2 1.6-.8l2.9-13.5c.3-1.3-.5-1.8-1.3-1.5L2.5 9.4c-1.3.5-1.3 1.2-.2 1.5l4.6 1.4L18.9 6c.7-.4 1.3-.2.8.2"/></svg>
          </span>
          Получить в Telegram
        </a>
      </div>
    </div>
  </section>

  <!-- Футер -->
  <footer class="border-t border-neutral-100 bg-white">
    <div class="container mx-auto px-4 py-6 grid md:grid-cols-4 gap-4 text-sm">
      <div class="md:col-span-2">
        <div class="flex items-center gap-2">
          <img src="./images/Arendatorkg.png" alt="Arendator.kg" class="w-7 h-7 rounded-full object-contain">
          <span class="font-semibold">Arendator.kg</span>
        </div>
        <p class="text-neutral-600 mt-2 max-w-[60ch]">Автоматически мониторим свежие объявления от владельцев и проверенных источников, чтобы вы нашли жильё быстрее и без посредников.</p>
      </div>
      <div>
        <div class="font-semibold">Навигация</div>
        <ul class="mt-2 space-y-1 text-neutral-600">
          <li><a href="post.html" class="hover:text-blue-600">Добавить объявление</a></li>
          <li><a href="blog.html" class="hover:text-blue-600">Блог</a></li>
        </ul>
      </div>
      <div>
        <div class="font-semibold">Правовое</div>
        <ul class="mt-2 space-y-1 text-neutral-600">
          <li><a class="hover:text-blue-600" href="data-deletion.html">Удаление данных</a></li>
          <li><a class="hover:text-blue-600" href="#">Политика конфиденциальности</a></li>
        </ul>
      </div>
    </div>
    <div class="text-center text-xs text-neutral-500 pb-5">© 2025 — Arendator.kg</div>
  </footer>

  <!-- === Скрипт загрузки объявлений === -->
  <script>
    // Настройки
    const API_URL = '/api/ads?limit=50';           // эндпоинт бэкенда
    const POLL_MS = 60_000;                        // частота обновления
    const BOT_LINK = 'https://t.me/ArendatorKg_VIP_bot';

    // Утилиты
    function escapeHtml(s='') {
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    function fmtPrice(v) {
      if (v === null || v === undefined || v === '') return 'Договорная';
      const n = Number(v);
      return isFinite(n) ? n.toLocaleString('ru-RU') + ' сом' : escapeHtml(String(v));
    }
    function firstPhoto(photos) {
      return (Array.isArray(photos) && photos.length) ? photos[0] : null;
    }

    // Рендер
    function renderAds(list) {
      const wrap = document.getElementById('ads');
      const empty = document.getElementById('ads-empty');
      wrap.innerHTML = '';
      if (!Array.isArray(list) || list.length === 0) {
        empty.hidden = false;
        return;
      }
      empty.hidden = true;

      for (const ad of list) {
        const title = escapeHtml(ad.title || 'Без названия');
        const price = fmtPrice(ad.price_text || ad.price);
        const district = escapeHtml(ad.district || 'Район не указан');
        const img = firstPhoto(ad.photos);

        const el = document.createElement('article');
        el.className = 'ad-card';
        el.innerHTML = `
          <div class="ad-thumb">
            ${img ? `<img src="${img}" alt="${title}">` : `<span>📷 фото нет</span>`}
          </div>
          <div class="ad-body">
            <h3 class="ad-title">${title}</h3>
            <div class="ad-price">${price}</div>
            <div class="ad-meta">📍 ${district}</div>
            <a class="ad-cta" href="${BOT_LINK}" target="_blank" rel="noopener">🔑 Получить контакты</a>
          </div>
        `;
        wrap.appendChild(el);
      }
    }

    async function loadAdsOnce() {
      try {
        const res = await fetch(API_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
        const data = await res.json();      // ожидается массив объектов
        renderAds(data);
      } catch (e) {
        console.warn('Не удалось загрузить объявления:', e);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadAdsOnce();
      setInterval(loadAdsOnce, POLL_MS);
    });

    /*
      Ожидаемый формат элемента объявления от бэкенда /api/ads:
      [
        {
          "id": "123",                        // строка или число
          "title": "2к, Центр, свежий ремонт",
          "price": 35000,                     // число или строка; можно price_text
          "district": "Центр",
          "photos": ["https://.../1.jpg", "..."], // массив URL (первая — обложка)
          "created_at": "2025-01-10T12:34:56Z"    // опционально
        }, ...
      ]
    */
  </script>
</body>
</html>
